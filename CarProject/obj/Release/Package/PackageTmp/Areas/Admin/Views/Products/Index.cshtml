@using db = CarProject.DBSEF
@using CarProject.App_Code

@{
    ViewBag.Title = "مدیریت محصولات";
    var dbcon = new db.CarAutomationEntities();

    int page = 0;
    if (Request.QueryString.AllKeys.Contains("page"))
    {
        int.TryParse(Request.QueryString["page"], out page);
    }
    int showInEachPage = 40;
}



<div id="prsContainers">
    @foreach (var item in dbcon.Products.OrderBy(p => p.ProductId).Skip(page * showInEachPage).Take(showInEachPage))
    {
        <div class="productItem">
            <div class="productAction">
                <a href="@Url.Action("Update", "Products", new { id = item.ProductId })" class="gia-edit"></a>
                <a href="javascript: void" onclick="DeleteProduct('@item.ProductId')" class="gia-remove"></a>
                <a href="@Url.Action("ShowDetails", "Products", new { id = item.ProductId })" class="gia-active"></a>
            </div>

            <table>
                <tr>
                    <th>شناسه</th>
                    <td>@item.ProductId</td>
                </tr>
                 <tr>
                    <th>نام</th>
                    <td>@item.ProductName</td>
                </tr>
                 <tr>
                    <th>دسته</th>
                    <td>@if(item.Category != null){@item.Category.CategoryName}</td>
                </tr>
                 <tr>
                    <th>شماره محصول</th>
                    <td>@item.PartNumber</td>
                </tr>
                 <tr>
                    <th>شرکت سازنده</th>
                    <td>@if(item.Manufacture != null){  @item.Manufacture.ManufactureName}</td>
                </tr>
                 <tr>
                    <th>کشور سازنده</th>
                    <td>@if(item.Country != null){ @item.Country.CountryLongName }</td>
                </tr>
                <tr>
                    <th>خودرو مربوطه</th>
                    <td>@if (item.Car != null) { <section>@item.Car.CarsBrandName - @item.Car.CarsModel</section> }</td>
                </tr>
                 <tr>
                    <th>تگ</th>
                    <td>@item.MetaTags</td>
                </tr>
                <tr>
                    <th>قیمت محصول - تاریخ</th>
                    <td>@if (item.ProductPrices.LastOrDefault() != null) { @item.ProductPrices.LastOrDefault().ProductPrice1} -@if (item.ProductPrices.LastOrDefault() != null && item.ProductPrices.LastOrDefault().Date.GetValueOrDefault() != DateTime.MinValue ) { @item.ProductPrices.LastOrDefault().Date.GetValueOrDefault().ToPersianDateString()  }</td>
                </tr>
            </table>
            
        </div>
    }
</div>


<div id="deleteBack">
    <div id="deleteMessage">
        <section>آیا از حذف محصول انتخابی اطمینان دارید؟</section>
        <form method="post" style="margin-top:5px; text-align:center;">
            <input type="hidden" name="deleteId" id="DeleteProductId" />
            
            <input type="submit" value="حذف محصول" class="button red" />
            <input type="button" value="انصراف" class="button blue"  onclick="closeDeleteMessage();"/>
        </form>
    </div>
</div>



@section style
{
    <style>
        .productItem {
            padding:5px;
            margin:5px;
            display:inline-block;
            border:thin solid #BBB;
            border-radius:5px;

            min-width:240px;
            overflow:hidden;
        }
            .productItem table {
                width:100%;
            }
            .productItem:hover {
                box-shadow:0 0 3px 0 #888;
            }


        .productItem th {
            text-align:right;
            padding: 1px 3px;
            background:#DEDEDE;
            white-space:nowrap;
        }
            .productItem th, 
            .productItem td {
                border:thin solid #DEDEDE;
            }

            .productItem td {
                width: 100%;
            }

        @@media (max-width:500px) {
            .productItem {
                display:block;
            }
        }

        .productAction {
            margin:-5px;
            margin-bottom:10px;
            padding:1px 10px;
            background:#666;

        }
            .productAction a {
                color:white;
            }
            .productAction a:hover {
                text-shadow: 0 0 0 #FFF, 1px 1px 1px #000;
            }


        #deleteBack {
            position:fixed;
            top:0; bottom:0; left:0; right:0;

            z-index:999999;
            background:rgba(0,0,0,.60);

            display:none;
            justify-content:center;
            align-items:center;
        }
            #deleteBack.show {
                display:flex;
            }
        #deleteMessage {
            background:white;
            border:thin solid #888;
            padding:10px;
            border-radius:5px;
        }
    </style>
}


@section script
{
    <script>
        function DeleteProduct(id) {
            document.getElementById("DeleteProductId").value = id;
            if (!document.getElementById("deleteBack").classList.contains("show"))
                document.getElementById("deleteBack").classList.add("show");
        }
        function closeDeleteMessage() {
            if (document.getElementById("deleteBack").classList.contains("show"))
                document.getElementById("deleteBack").classList.remove("show");
        }
    </script>
}