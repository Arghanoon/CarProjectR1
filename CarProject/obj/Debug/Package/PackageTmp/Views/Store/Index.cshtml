@{
    ViewBag.Title = "فروشگاه";
    var dbs = new CarProject.DBSEF.CarAutomationEntities();

    var slides = dbs.SlideShows.Where(s => s.Type == 1).ToList();
    var slides2 = dbs.SlideShows.Where(s => s.Type == 2).ToList();

    var lastnews = dbs.Contents.OrderByDescending(c => c.ContenstId).Take(10);

    var rand = new Random();
}


@section style
{
    <link href="~/Publics/Files/Resources/StorePage/index.css" rel="stylesheet" />
}

<div style="margin: 10px;">

    <div id="TopSliderAndNews">
        <div id="newsBar">
            <div class="newsContainer" id="LastNews">

                @foreach (var item in lastnews)
                {
                    var imagelink = "~/Publics/Gallery/ProductImages/NotFound.png";
                    var path = "~/Publics/Gallery/NewsImages/" + item.ContenstId;
                    var dicinfo = new DirectoryInfo(Server.MapPath(path));
                    if (dicinfo.Exists)
                    {
                        var files = dicinfo.GetFiles();
                        if (files.Length > 0)
                        {
                            imagelink = path + "/" + files[rand.Next(0, files.Length)].Name;
                        }
                    }
                    <div class="newsItem">

                        <img src="@Url.Content(imagelink)" alt="@item.ContentSubject" />

                        <div class="newsItemInfo">
                            <strong class="title">@item.ContentSubject</strong>

                            <section class="briefshow">
                                @item.ContentDescribe
                            </section>

                            <section class="footer">
                                <a href="@Url.RouteUrl("infoRoute", new { controller = "News", action = "NewsShow", id = item.ContenstId, info1 = item.ContentsCategory.Name, info2 = item.ContentSubject })">ادامه ... </a>
                            </section>
                        </div>


                    </div>
                }
            </div>
        </div>

        <div class="SliderType2" style="min-height: 500px; margin-bottom: 10px;" id="topMainSlideShower">
            <div class="sliderItems">
                @{int i = 1; }
                @foreach (var item in slides)
                {
                    <a href="@item.Url" class="slideItem" data-slide="@i">
                        <img src="@item.Image" alt="" />
                    </a>
                    i++;
                }
            </div>
            <div class="sliderTitles">
                @{ i = 1; }
                @foreach (var item in slides)
                {
                    <section onClick="SliderType2ChangeSlide_byelement(this)" data-slide='@i' class="flex-column-center-stretch">
                        <h3>@item.Subject </h3>
                        <small>@item.Describe</small>
                    </section>
                    i++;
                }

            </div>
        </div>
    </div>


    <div id="Contianer1" style="">
        <div style="margin-left: 5px; margin-top: -2.5px;" id="rightSideBar">
            <div id="BrandsContainer" class="SideBarItemsContainer">
                @{
                    var brands = dbs.CarBrands.Take(30);
                    foreach (var item in brands)
                    {
                        DirectoryInfo di = new DirectoryInfo(Server.MapPath("~/Publics/Gallery/Brands"));
                        var f = di.GetFiles(string.Format("{0}.*", item.CarBrandId));
                        if (f.Length > 0)
                        {
                            <a href="#" data-title="@item.CarBrandName">
                                <img src="~/Publics/Gallery/Brands/@f[0].Name" alt="@item.CarBrandName" />
                            </a>
                        }
                    }
                }
            </div>

            <h3>خودروها</h3>
            <div id="CarsContainer" class="SideBarItemsContainer">
                @{
                    var cars = dbs.Cars.OrderByDescending(c => c.CarsId).Take(30);
                    foreach (var item in cars)
                    {
                        var imgpaht = "~/Publics/Gallery/CarImages/" + item.CarsId.ToString();
                        var dicinfo = new DirectoryInfo(Server.MapPath(imgpaht));
                        if (dicinfo.Exists)
                        {
                            var imgs = dicinfo.GetFiles();
                            if (imgs.Length > 0)
                            {
                                var inrnd = rand.Next(0, imgs.Length);
                                <a href="@Url.RouteUrl("infoRoute", new { controller = "Cars", action = "Car", id = item.CarsId, info1 = item.CarModel.CarBrand.CarBrandName, info2 = item.CarModel.CarModelName })" data-title="@item.CarModel.CarBrand.CarBrandName - @item.CarModel.CarModelName">
                                    <img src="@Url.Content(@imgpaht + "/" + @imgs[inrnd].Name)" alt="@item.CarModel.CarBrand.CarBrandName - @item.CarModel.CarModelName" />
                                </a>
                            }
                        }
                    }
                }
            </div>
        </div>

        <div id="itemsShowing1">
            <div class="SliderType1" style="height: 400px; margin-right: 5px;">
                <div class="w25 sliderTitles">
                    @{i = 1; }
                    @foreach (var item in slides2)
                    {
                        <section onclick="SliderType1ChangeSlide_byelement(this)" class="slideItem" data-slide="@i">
                            <strong>@item.Subject</strong><br />
                            <small>@item.Describe</small>
                        </section>
                        i++;
                    }
                </div>
                <div class="w75 sliderItems">
                    @{i = 1; }
                    @foreach (var item in slides2)
                    {
                        <a href="@item.Url" class="slideItem" data-slide="@i">
                            <img src="@item.Image" alt="" />
                        </a>
                        i++;
                    }
                </div>
            </div>

            <div style="margin-top: 5px; margin-right: 5px;">
                <h4>آخرین محصولات</h4>
                <div class="SliderType3" data-slidewidth="300px">
                    <div class="sliderItems">
                        @{
                            var xNews = dbs.Products.OrderByDescending(p => p.ProductId).Take(20);
                            foreach (var item in xNews)
                            {
                                var PicFileUrl = "~/Publics/Gallery/ProductImages/" + item.ProductId;
                                var finfo = new System.IO.DirectoryInfo(Server.MapPath(PicFileUrl));
                                
                                var Product_image_src = "~/Publics/Gallery/ProductImages/NotFound.png";
                                if (finfo.Exists && finfo.GetFiles().Count() > 0)
                                {
                                    //Product_image_src = PicFileUrl + "/" + finfo.GetFiles()[rand.Next(0, finfo.GetFiles().Length)].Name;
                                    Product_image_src = PicFileUrl + "/" + finfo.GetFiles()[0].Name;
                                }

                                    <a href="@Url.RouteUrl("infoRoute", new { controller = "Store", action = "Products", id = item.ProductId, info1 = item.Category.CategoryName, info2 = item.ProductName })" class="slideItem">
                                        <img src="@Url.Content(Product_image_src)" alt="@item.Category.CategoryName @item.ProductName" />
                                        <section>
                                            <strong>@item.ProductName</strong><br />
                                            <small>@item.Category.CategoryName</small><br />
                                            <small class="price">@if (item.ProductPrices.Any())
                                            {<span>@string.Format("{0:#,###0}",@item.ProductPrices.Last().ProductPrice1)</span>}
                                            else
                                            {<span>0</span>} تومان</small>
                                        </section>
                                    </a>
                            }

                        }
                    </div>

                    <div class="sliderNav left gia-left"></div>
                    <div class="sliderNav right gia-right"></div>
                </div>
            </div>


            <div style="margin-top: 5px; margin-right: 5px;">
                <h4>آخرین خدمات</h4>
                <div class="SliderType3" data-slidewidth="300px">
                    <div class="sliderItems">
                        @{
                            var xServices = dbs.AutoServices.OrderByDescending(p => p.AutoServiceId).Take(20);
                            foreach (var item in xServices)
                            {
                                var PicFileUrl = "~/Publics/Gallery/Services/" + item.AutoServiceId;
                                            var finfo = new System.IO.DirectoryInfo(Server.MapPath(PicFileUrl));
                                            var src = "~/Publics/Gallery/ProductImages/NotFound.png";

                                if (finfo.Exists && finfo.GetFiles().Count() > 0)
                                { src = Url.Content(PicFileUrl + "/" + finfo.GetFiles()[rand.Next(0, finfo.GetFiles().Length)].Name); }

                                <a href="@Url.RouteUrl("infoRoute", new { controller = "Store", action = "ServiceView", id = item.AutoServiceId, info1 = "سرویسها" , info2 = item.AutoServiceName })" class="slideItem">
                                    <img src="@Url.Content(src)" alt="@item.AutoServiceName" />
                                    <section>
                                        <strong>@item.AutoServiceName</strong><br />
                                        @*<small>@item.Category.CategoryName</small><br />*@
                                        <small class="price">@string.Format("{0:#,###0}",@item.Price) تومان</small>
                                    </section>
                                </a>

                            }

                        }
                    </div>

                    <div class="sliderNav left gia-left"></div>
                    <div class="sliderNav right gia-right"></div>
                </div>
            </div>

            <div style="margin-top: 5px; margin-right: 5px;">
                <h4>آخرین بسته های خدماتی</h4>
                <div class="SliderType3" data-slidewidth="300px">
                    <div class="sliderItems">
                        @{
                            var xServicePacks = dbs.AutoServicePacks.OrderByDescending(p => p.AutoServicePackId).Take(20);
                            foreach (var item in xServicePacks)
                            {
                                var PicFileUrl = "~/Publics/Gallery/ServicePacks/" + item.AutoServicePackId;
                                var finfo = new System.IO.DirectoryInfo(Server.MapPath(PicFileUrl));
                                var src = "~/Publics/Gallery/ProductImages/NotFound.png";

                                if (finfo.Exists && finfo.GetFiles().Count() > 0)
                                { src = Url.Content(PicFileUrl + "/" + finfo.GetFiles()[rand.Next(0, finfo.GetFiles().Length)].Name); }

                                <a href="@Url.RouteUrl("infoRoute", new { controller = "Store", action = "ServicePackView", id = item.AutoServicePackId, info1 = "سرویسها پکها" , info2 = item.AutoServicePackName })" class="slideItem">
                                    <img src="@Url.Content(src)" alt="@item.AutoServicePackName" />
                                    <section>
                                        <strong>@item.AutoServicePackName</strong><br />
                                        <small class="price">@string.Format("{0:#,###0}", @item.PackPrice) تومان</small>
                                    </section>
                                </a>

                            }

                                        }
                    </div>

                    <div class="sliderNav left gia-left"></div>
                    <div class="sliderNav right gia-right"></div>
                </div>
            </div>
            @*<div style="margin-top: 5px; margin-right: 5px;">
                    <h4>آخرین بسته های خدماتی</h4>
                    <div class="ServicePacksContainer">
                        @{
                            var servicesPacks = dbs.AutoServicePacks.OrderByDescending(sp => sp.AutoServicePackId).Take(12);

                            foreach (var item in servicesPacks)
                            {
                                <a href="@Url.RouteUrl("infoRoute", new { controller = "Store", action = "ServicePackView", id = item.AutoServicePackId, info1 = "سرویسها پکها" , info2 = item.AutoServicePackName })" class="item">
                                    <h2>@item.AutoServicePackName</h2>
                                    <small>@item.Details</small>
                                    <p class="price" style="margin-top:auto;">@item.PackPrice ریال</p>
                                </a>
                            }
                        }
                    </div>
                </div>*@

        </div>
    </div>
</div>


